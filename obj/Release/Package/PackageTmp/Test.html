<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="Content/bootstrap.min.css">
    <link rel="stylesheet" href="Content/jquery.datatables.min.css">
    <script src="Scripts/jquery-3.3.1.min.js"></script>
    <script src="Scripts/DataTables/jquery.dataTables.min.js"></script>
    <script src="Scripts/bootstrap.js"></script>
    <script src="Scripts/Func/Util.js"></script>
    <title>Template</title>
</head>
<body>
    <div class="panel-primary">
        <div class="panel-heading">
            <h4 class="panel-title">
                Test Create Modal
            </h4>
        </div>
        <div class="panel-body">
            <div id="dvLOVs">
            </div>
            <input type="button" id="btn1" value="Show Branch" onclick="OpenLOV()"/>
        </div>
        <div class="panel-footer">
            <p>&copy; Tawan Technology Co.,ltd</p>
        </div>
    </div>
    <script type="text/javascript">
        var path = '/';
        $(document).ready(function () {
            $.get(path + 'Config/ListValue?ID=tbX&Head=cpX&FLD=code,key,name', function (response) {
                var dv = document.getElementById("dvLOVs");
                //Customers
                CreateLOV(dv, '#frmSearchBranch', '#tbBranch', 'Branch', response, 2);
            });
        });
        function OpenLOV() {
            SetGridBranch(path, '#tbBranch', '#frmSearchBranch', ReadBranch);
        }
        function ReadBranch(dt) {
            alert(dt.BrName);
        }
        function CreateLOV(dv, frm, tb, name, html, c) {
            if (c <= 2) html = html.replace('<th>name</th>', '');
            if (c == 1) html = html.replace('<th>key</th>', '');

            var lov = document.createElement("div");
            lov.className = "modal fade";
            lov.setAttribute("role", "dialog");
            lov.id = frm.replace("#","");
            dv.appendChild(lov);

            var struct = html.replace('tbX', tb.replace("#", "")).replace('cpX', name);
            BindList(frm, tb, struct);
        }
        function BindList(d, t, l) {
            //use for set html of tables and set focus when showing
            $(d).html(l);
            $(d).on('shown.bs.modal', function () {
                $(t + '_filter input').focus();
            });
        }
        function BindEvent(t, d, ev) {
            //use for bind event of popup when click some row and selected data
            $(t + ' tbody').on('click', 'button', function () {
                var dt = GetSelect(t, this); //read current row selected
                ev(dt); //callback function from caller 
                $(d).modal('hide');
            });
            $(t + ' tbody').on('click', 'tr', function () {
                $(t + ' tbody > tr').removeClass('selected'); //ล้างทุก row ที่มีการ select ก่อน
                $(this).addClass('selected'); //select row ใหม่
            });
            $(d).modal('show');
        }
        function SetGridBranch(p, g, d, ev) {
            $(g).DataTable({
                ajax: {
                    url: p + 'Config/GetBranch', //web service ที่จะ call ไปดึงข้อมูลมา
                    dataSrc: 'branch.data'
                },
                selected: true, //ให้สามารถเลือกแถวได้
                columns: [ //กำหนด property ของ header column
                    { data: null, title: "#" },
                    { data: "Code", title: "รหัส" },
                    { data: "BrName", title: "ชื่อ" }
                ],
                "columnDefs": [ //กำหนด control เพิ่มเติมในแต่ละแถว
                    {
                        "targets": 0, //column ที่ 0 เป็นหมายเลขแถว
                        "data": null,
                        "render": function (data, type, full, meta) {
                            var html = "<button class='btn btn-warning'>Select</button>";
                            return html;
                        }
                    }
                ],
                destroy: true //ให้ล้างข้อมูลใหม่ทุกครั้งที่ reload page
            });
            BindEvent(g, d, ev);
        }

    </script>
</body>
</html>