<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Job Acknowledgement</title>
    <link rel="stylesheet" type="text/css" href="Content/sheets-of-paper-a4.css">
    <script src="Scripts/jquery-3.2.1.min.js"></script>
    <script src="Scripts/Func/util.js"></script>
</head>
<body class="document">
    <div class="page" contenteditable="false">
        <table id="tblHeader" width="100%">
            <tr>
                <td>
                    <img id="imgLogo" src="Resource/logo-idl.jpg" width="80%" />
                </td>
                <td>
                    <div id="divCompany" style="text-align:left;color:darkblue;"></div>
                </td>
            </tr>
        </table>
        <hr />
        <table id="tbAdvInfo" width="100%">
            <tr>
                <td colspan="3" style="font-size:11px">
                    <b>Advance No : </b><label id="lblAdvNo" style="text-decoration-line:underline"></label>
                </td>
                <td align="right" style="font-size:11px">
                    <input type="text" value="ADVANCE" style="text-align:center;background-color:yellow;font:bold;font-size:large;" disabled />
                </td>
            </tr>
            <tr>
                <td colspan="3" style="font-size:11px">
                    <b>Customer : </b><label id="lblCustCode" style="text-decoration-line:underline;"></label>
                    <br/><label id="lblCustName" style="text-decoration-line:underline;"></label>
                </td>
                <td align="right" style="font-size:11px">
                    <b>Advance Date : </b><label id="lblAdvDate" style="text-decoration-line:underline;"></label>
                </td>
            </tr>
            <tr>
                <td colspan="2" style="font-size:11px">
                    <b>Job Type : </b><label id="lblJobType" style="text-decoration-line:underline;"></label>
                    <b>Ship By : </b><label id="lblShipBy" style="text-decoration-line:underline;"></label>
                </td>
                <td align="right" colspan="2" style="font-size:11px">
                    <b>Advance Type : </b><label id="lblAdvType" style="text-decoration-line:underline;"></label>
                </td>
            </tr>
            <tr>
                <td colspan="3" style="font-size:11px">
                    <b>Remark</b>
                    <label id="lblRemark" style="text-decoration-line:underline;"></label>
                </td>
                <td align="right" style="font-size:11px">
                    <b>Request Date : </b><label id="lblReqDate" style="text-decoration-line:underline;"></label>
                </td>
            </tr>
        </table>
        <br/>
        <table width="100%" style="border-collapse:collapse;">
            <tr style="text-align:center;">
                <td style="border-style:solid;border-width:thin;font-size:11px">
                    <b>Advance Expenses</b>
                </td>
                <td style="border-style:solid;border-width:thin;font-size:11px"><b>Job Number</b></td>
                <td style="border-style:solid;border-width:thin;font-size:11px"><b>Amount</b></td>
            </tr>
            <tr style="height:450px;vertical-align:top">
                <td style="border-style:solid;border-width:thin;text-align:left">
                    <div id="divDesc" style="font-size:12px"></div>
                </td>
                <td style="border-style:solid;border-width:thin;text-align:left">
                    <div id="divJob" style="font-size:12px"></div>
                </td>
                <td style="border-style:solid;border-width:thin;text-align:right">
                    <div id="divAmt" style="font-size:12px"></div>
                </td>
            </tr>
            <tr>
                <td style="text-align:left;font-size:11px">
                    <input type="checkbox" id="chkCash"/> CASH/TRANSFER : <label id="lblAccNo">______________</label>
                </td>
                <td style="border-style:solid;border-width:thin;text-align:right;font-size:11px" width="130px">Net Amount</td>
                <td style="border-style:solid;border-width:thin" width="150px">
                    <input type="text" style="border:none;text-align:right;font-size:11px" id="txtNetAmt" />
                </td>
            </tr>
            <tr>
                <td style="text-align:left;font-size:11px">
                    <input type="checkbox" id="chkCustChq"/> CUST.CHQ NO : <label id="lblcustChqNo">__________</label> DEP.DATE : <label id="lblDepDate">________</label>
                </td>
                <td style="border-style:solid;border-width:thin;text-align:right;font-size:11px" width="130px">
                VAT
                </td>
                <td style="border-style:solid;border-width:thin" width="150px">
                    <input type="text" style="border:none;text-align:right;font-size:11px" id="txtVATAmt" />
                </td>
            </tr>
            <tr>
                <td style="text-align:left;font-size:11px">
                    <input type="checkbox" id="chkCompChq"/> CHQ NO : <label id="lblCompChqNo">__________</label> CHQ.DATE : <label id="lblChqDate">________</label>
                </td>
                <td style="border-style:solid;border-width:thin;text-align:right;font-size:11px" width="130px">WH-Tax</td>
                <td style="border-style:solid;border-width:thin" width="150px">
                    <input type="text" style="border:none;text-align:right;font-size:11px" id="txtWHTAmt" />
                </td>
            </tr>
            <tr>
                <td style="text-align:left;font-size:11px;">
                    <input type="checkbox" id="chkCredit"/> ACCOUNT PAYABLES :
                </td>
                <td style="border-style:solid;border-width:thin;text-align:right;font-size:11px" width="130px">Total</td>
                <td style="border-style:solid;border-width:thin" width="150px">
                    <input type="text" style="border:none;text-align:right;font-size:11px" id="txtTotalAmt" />
                </td>
            </tr>
        </table>
        <br />
        TOTAL : <input type="text" id="txtTotalText" value="ZERO BAHT ONLY" style="font-size:11px;background-color:burlywood;font:bold;text-align:center;width:90%;" disabled />
        <br />
        PAY TO : <label id="lblPayTo"style="font-size:11px">________________________________________________________________________</label>
        <br />
        <br />
        <table width="100%" style="border-collapse:collapse;">
            <tr>
                <td style="border-style:solid;border-width:thin;text-align:center;vertical-align:top">
                    REQUEST.BY
                </td>
                <td style="border-style:solid;border-width:thin;text-align:center;vertical-align:top">
                    APPROVE.BY
                </td>
                <td style="border-style:solid;border-width:thin;text-align:center;vertical-align:top">
                    PAYMENT.BY
                </td>
                <td style="border-style:solid;border-width:thin;text-align:center;vertical-align:top">
                    POSTED.BY
                </td>
                <td style="border-style:solid;border-width:thin;text-align:center;vertical-align:top">
                    CLEARED.BY
                </td>
            </tr>
            <tr>
                <td style="border-style:solid;border-width:thin;text-align:center;vertical-align:bottom" height="100px">
                    <label id="lblReqBy" style="font-size:10px">(__________________)</label><br/>
                    <label id="lblRequestDate" style="font-size:9px">__/__/____</label>
                </td>
                <td style="border-style:solid;border-width:thin;text-align:center;vertical-align:bottom">
                    <label id="lblAppBy" style="font-size:10px">(__________________)</label><br />
                    <label id="lblAppDate" style="font-size:9px">__/__/____</label>
                </td>
                <td style="border-style:solid;border-width:thin;text-align:center;vertical-align:bottom">
                    <label id="lblPayBy" style="font-size:10px">(__________________)</label><br />
                    <label id="lblPayDate" style="font-size:9px">__/__/____</label>
                </td>
                <td style="border-style:solid;border-width:thin;text-align:center;vertical-align:bottom">
                    <label id="lblPostBy" style="font-size:9px">(__________________)</label><br />
                    <label id="lblPostDate" style="font-size:9px">__/__/____</label>
                </td>
                <td style="border-style:solid;border-width:thin;text-align:center;vertical-align:bottom">
                    <label id="lblClrBy" style="font-size:9px">(__________________)</label><br />
                    <label id="lblClrDate" style="font-size:9px">__/__/____</label>
                </td>
            </tr>
        </table>
    </div>
<script type="text/javascript">
    var serv = [];
    $(document).ready(function () {
        ShowCompany();
        var br = getQueryString('BranchCode');
        var ano = getQueryString('AdvNo');
        if (br !== '' && ano !== '') {
            GetAdv(br, ano);
        } else {
            var r = GetDummy();
            ShowData(r);
        }
    });
    function GetAdv(Branch, Doc) {
        $.get('adv/getadvance?branchcode=' + Branch + '&advno=' + Doc)
            .done(function (r) {
                if (r.adv.header.length > 0) {
                    ShowData(r);
                    return;
                }
            });
    }
    function LoadServices(d,h) {
        $.get('Master/GetServiceCode')
            .done(function (r) {
                serv = r.servicecode.data;
                ShowDetail(d,h);
            });
    }
    function GetDummy(){
        var data = { "adv": { "header": [{ "BranchCode": "00", "AdvNo": "DAV-1808-0003", "CustCode": "MPENS", "CustBranch": "0000", "JobType": 1, "ShipBy": 7, "AdvDate": "2018-08-01T00:08:00", "AdvType": 1, "EmpCode": "JIRAKUL", "JNo": "DIF1808-00002", "InvNo": "", "DocStatus": 4, "VATRate": 7, "TotalAdvance": 2294.8, "TotalVAT": 159.24, "Total50Tavi": 22.75, "TRemark": "TESTESTESTESTESTESTESTEST", "ApproveBy": "JIRAKUL", "ApproveDate": "2018-08-01T00:08:00", "ApproveTime": "1900-01-01T08:49:48", "PaymentBy": "MANASANOK", "PaymentDate": "2018-08-01T00:08:00", "PaymentTime": "1900-01-01T08:54:51", "PaymentRef": "PV-D1808-0003", "CancelReson": "", "CancelProve": "", "CancelDate": "0001-01-01T00:00:00", "CancelTime": "1900-01-01T00:00:00", "AdvCash": 0.0, "AdvChqCash": 2431.29, "AdvChq": 0.0, "AdvCred": 0.0, "PayChqTo": "PENANSHIN SHIPPING (THAILAND) LTD.", "PayChqDate": "0001-01-01T00:00:00", "Doc50Tavi": "DWT-1808-0042" }], "detail": [{ "BranchCode": "00", "AdvNo": "DAV-1808-0003", "ItemNo": 1, "STCode": "STD", "SICode": "SNG-112", "AdvAmount": 1000.0, "IsChargeVAT": 1, "ChargeVAT": 70.0, "Rate50Tavi": 1.0, "Charge50Tavi": 10.0, "TRemark": "", "IsDuplicate": 0, "PayChqTo": null, "Doc50Tavi": null, "ForJNo": "DIF1808-00002" }, { "BranchCode": "00", "AdvNo": "DAV-1808-0003", "ItemNo": 2, "STCode": "STD", "SICode": "SNG-065", "AdvAmount": 216.0, "IsChargeVAT": 1, "ChargeVAT": 15.12, "Rate50Tavi": 1.0, "Charge50Tavi": 2.16, "TRemark": "", "IsDuplicate": 0, "PayChqTo": null, "Doc50Tavi": null, "ForJNo": "DIF1808-00002" }, { "BranchCode": "00", "AdvNo": "DAV-1808-0003", "ItemNo": 3, "STCode": "STD", "SICode": "SNG-064", "AdvAmount": 216.0, "IsChargeVAT": 1, "ChargeVAT": 15.12, "Rate50Tavi": 1.0, "Charge50Tavi": 2.16, "TRemark": "", "IsDuplicate": 0, "PayChqTo": null, "Doc50Tavi": null, "ForJNo": "DIF1808-00002" }, { "BranchCode": "00", "AdvNo": "DAV-1808-0003", "ItemNo": 4, "STCode": "STD", "SICode": "SNG-113", "AdvAmount": 200.0, "IsChargeVAT": 1, "ChargeVAT": 14.0, "Rate50Tavi": 1.0, "Charge50Tavi": 2.0, "TRemark": "", "IsDuplicate": 0, "PayChqTo": null, "Doc50Tavi": null, "ForJNo": "DIF1808-00002" }, { "BranchCode": "00", "AdvNo": "DAV-1808-0003", "ItemNo": 5, "STCode": "STD", "SICode": "SNG-118", "AdvAmount": 64.8, "IsChargeVAT": 1, "ChargeVAT": 4.54, "Rate50Tavi": 1.0, "Charge50Tavi": 0.65, "TRemark": "", "IsDuplicate": 0, "PayChqTo": null, "Doc50Tavi": null, "ForJNo": "DIF1808-00002" }, { "BranchCode": "00", "AdvNo": "DAV-1808-0003", "ItemNo": 6, "STCode": "STD", "SICode": "SNG-117", "AdvAmount": 108.0, "IsChargeVAT": 1, "ChargeVAT": 7.56, "Rate50Tavi": 1.0, "Charge50Tavi": 1.08, "TRemark": "", "IsDuplicate": 0, "PayChqTo": null, "Doc50Tavi": null, "ForJNo": "DIF1808-00002" }, { "BranchCode": "00", "AdvNo": "DAV-1808-0003", "ItemNo": 7, "STCode": "STD", "SICode": "SNG-067", "AdvAmount": 200.0, "IsChargeVAT": 1, "ChargeVAT": 14.0, "Rate50Tavi": 1.0, "Charge50Tavi": 2.0, "TRemark": "", "IsDuplicate": 0, "PayChqTo": null, "Doc50Tavi": null, "ForJNo": "DIF1808-00002" }, { "BranchCode": "00", "AdvNo": "DAV-1808-0003", "ItemNo": 8, "STCode": "STD", "SICode": "SNG-116", "AdvAmount": 270.0, "IsChargeVAT": 1, "ChargeVAT": 18.9, "Rate50Tavi": 1.0, "Charge50Tavi": 2.7, "TRemark": "", "IsDuplicate": 0, "PayChqTo": null, "Doc50Tavi": null, "ForJNo": "DIF1808-00002" }, { "BranchCode": "00", "AdvNo": "DAV-1808-0003", "ItemNo": 9, "STCode": "STD", "SICode": "SNG-029", "AdvAmount": 20.0, "IsChargeVAT": 0, "ChargeVAT": 0.0, "Rate50Tavi": 0.0, "Charge50Tavi": 0.0, "TRemark": "", "IsDuplicate": 0, "PayChqTo": null, "Doc50Tavi": null, "ForJNo": "DIF1808-00002" }] } }
        return data;
    }
    function GetConfig(Code, Key, ControlID) {
        $.get('Config/GetConfig?Code='+Code+'&Key=' + Key)
            .done(function (r) {
                var b = r.config.data;
                if (b.length > 0) {
                    $(ControlID).text(b[0].ConfigValue);
                }
            });
    }
    function ShowData(data) {
        //show headers
        var h = data.adv.header[0];
        $('#lblAdvNo').text(h.AdvNo);
        $('#lblReqDate').text(CDateTH(GetToday()));
        $('#lblCustCode').text(h.CustCode + '/' + h.CustBranch);
        $('#lblRemark').text(h.TRemark);
        $('#lblAdvDate').text(CDateTH(h.AdvDate));
        $('#lblPayTo').text(h.PayChqTo);

        ShowCustomer(h.CustCode, h.CustBranch);

        ShowUser(h.EmpCode, '#lblReqBy');
        ShowUser(h.ApproveBy, '#lblAppBy');
        ShowUser(h.PaymentBy, '#lblPayBy');

        $('#lblRequestDate').text(CDateTH(h.AdvDate));
        $('#lblAppDate').text(CDateTH(h.ApproveDate));
        $('#lblPayDate').text(CDateTH(h.PaymentDate));

        var jt = h.JobType;
        var sb = h.ShipBy;
        var at = h.AdvType;
        if (jt < 10) jt = '0' + jt;
        if (sb < 10) sb = '0' + sb;
        if (at < 10) at = '0' + at;
        GetConfig('JOB_TYPE', jt, '#lblJobType');
        GetConfig('SHIP_BY', sb, '#lblShipBy');
        GetConfig('ADV_TYPE', at, '#lblAdvType');
        if (h.AdvCash > 0) {
            $('#chkCash').prop('checked', true);
        }
        if (h.AdvChq > 0) {
            $('#chkCustChq').prop('checked', true);
        }
        if (h.AdvChqCash > 0) {
            $('#chkCompChq').prop('checked', true);
        }
        if (h.AdvCred > 0) {
            $('#chkCredit').prop('checked', true);
        }
        $('#txtNetAmt').val(CCurrency(h.TotalAdvance.toFixed(2)));
        $('#txtVATAmt').val(CCurrency(h.TotalVAT.toFixed(2)));
        $('#txtWHTAmt').val(CCurrency(h.Total50Tavi.toFixed(2)));
        $('#txtTotalAmt').val(CCurrency((h.TotalAdvance + h.TotalVAT - h.Total50Tavi).toFixed(2)));

        $('#txtTotalText').val(CNumEng(CCurrency((h.TotalAdvance + h.TotalVAT - h.Total50Tavi).toFixed(2))));
        //show details
        var d = data.adv.detail;
        LoadServices(d,h);
    }
    function ShowCustomer(Code, Branch) {
            $('#lblCustName').text('-');
        if ((Code + Branch).length > 0) {
            $.get('Master/GetCompany?Code=' + Code + '&Branch=' + Branch)
                .done(function (r) {
                    if (r.company.data.length > 0) {
                        var c = r.company.data[0];
                        $('#lblCustName').text(c.NameThai);
                    }
                });
        }
    }
    function ShowUser(UserID, ControlID) {
        if (UserID != "") {
            $.get('Master/GetUser?Code=' + UserID)
                .done(function (r) {
                    if (r.user.data.length > 0) {
                        var b = r.user.data[0];
                        $(ControlID).text('(' + b.TName + ')');
                    }
                });
        }
    }
    function ShowDetail(r,h) {

        //Dummy Data
        var strDesc = '';
        var strJob = '';
        var strAmt = '';
        var totAmt = 0;
        //var vat = 0;
        //var wht = 0;
        for (i = 0; i < r.length; i++) {
            var d = r[i];
            if (serv.length > 0) {
                var c = $.grep(serv, function (data) {
                    return data.SICode === d.SICode;
                });
                if (c.length > 0) {
                    strDesc = strDesc + (d.SICode + '-' + c[0].NameThai + '<br/>');
                } else {
                    strDesc = strDesc + (d.SICode + '-Not found Expenses<br/>');
                }
            } else {
                strDesc = strDesc + (d.SICode + '<br/>');
            }
            strJob = strJob + (d.ForJNo + '<br/>');
            strAmt = strAmt + (CCurrency((d.AdvAmount).toFixed(2)) + '<br/>');
            totAmt += d.AdvAmount;
            //vat += d.ChargeVAT;
            //wht += d.Charge50Tavi;
        }
        $('#divDesc').html(strDesc);
        $('#divJob').html(strJob);
        $('#divAmt').html(strAmt);        
    }
    function ShowCompany() {
        var c = DummyCompanyData();
        $('#divCompany').html('<b>' + c.CompanyName + '</b>'
            + '<br/>' + c.CompanyAddress1
            + ' '
            + c.CompanyAddress2);
    }
</script>
</body>
</html>